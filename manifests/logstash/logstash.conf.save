input {
  http {
    id => "testing"
    port => 5045
  }
  beats {
    port => 5044
  }
}

filter {
  grok {
    match => { "message" => "%{TIMESTAMP_ISO8601:timestamp} %{LOGLEVEL:level} %{IPV4:serverIP} %{GREEDYDATA:messageDetail}" }
  }
  ip2location {
    source => "serverIP    use_memory_mapped => true
  }
  geoip {
    source => "serverIP"
  }
  mutate {
    gsub => [
              "messageDetail", "([\[])([A-Za-z]*)= .*([\]])", "[data anonymised]",
              "message", "([\[])([A-Za-z]*)= .*([\]])", "[data anonymised]"  
            ]
  }
}

output {
  elasticsearch {
    hosts => ["172.19.0.1:9200"]
    index => "testingindex"
  }
  stdout {
    codec => rubydebug
  }
}
